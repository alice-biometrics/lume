name: onboarding-sandbox

install:
  run:
  - pip install -r requirements/dev.txt -r requirements/test.txt -r requirements/requirements.txt
steps:
  clean:
    run:
    - rm -rf deps
    - rm -rf output
    - rm -rf docs/build
    - find . | grep -E "(__pycache__|\.pyc|\.pyo$)" | xargs rm -rf
  setup:
    output: deps
    deps:
      gcs-credentials:
        type: file
        url: https://intranet.gradiant.org/nexus/repository/raw-dataset-biometrics/facerecognition-rest-assets/facerecognition-rest-assets.zip
        name: facerecognition-rest-assets
        auth_required: true
        credentials_env: NEXUS_CREDENTIALS
        unzip: true
  build:
    run:
    - mkdir -p output
    - python update_version.py
  lint:
    run:
    - black .
    - flake8 onboardingsandbox
  test:
    run:
    - make html
    - mkdir -p ../output/doc/html
    - cp -r build/html ../output/doc